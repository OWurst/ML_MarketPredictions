---
title: "CS 2075 Spring 2023 Final Project: Part 3: Classification"
author: "Owen Wurst"
date: "Started January 3rd, 2024"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, imports}
library(tidyverse)
source("Data_Prep_Functions.r")
```

#Data Preparation:
##Reading in Data:
I will start by reading the csv files for all of the data. I will add a column for ticker and industry to each df.
```{r, create_df_list}
#Tech
apple <- readr::read_csv("Original_Datasets/YahooFinance/AAPL.csv", col_names = TRUE, show_col_types = FALSE)
appl_df <- prep_df_post_csv_read(apple, "APPL", "Tech")

nvidia <- readr::read_csv("Original_Datasets/YahooFinance/NVDA.csv", col_names = TRUE, show_col_types = FALSE)
nvda_df <- prep_df_post_csv_read(nvidia, "NVDA", "Tech")

meta <- readr::read_csv("Original_Datasets/YahooFinance/META.csv", col_names = TRUE, show_col_types = FALSE)
meta_df <- prep_df_post_csv_read(meta, "META", "Tech")

#Pharma
jnj <- readr::read_csv("Original_Datasets/YahooFinance/JNJ.csv", col_names = TRUE, show_col_types = FALSE)
jnj_df <- prep_df_post_csv_read(jnj, "JNJ", "Pharma")

moderna <- readr::read_csv("Original_Datasets/YahooFinance/MRNA.csv", col_names = TRUE, show_col_types = FALSE)
mrna_df <- prep_df_post_csv_read(moderna, "MRNA", "Pharma")

abbvie <- readr::read_csv("Original_Datasets/YahooFinance/ABBV.csv", col_names = TRUE, show_col_types = FALSE)
abbv_df <- prep_df_post_csv_read(abbvie, "ABBV", "Pharma")

#Banking
jpmorg <- readr::read_csv("Original_Datasets/YahooFinance/JPM.csv", col_names = TRUE, show_col_types = FALSE)
jpm_df <- prep_df_post_csv_read(jpmorg, "JPM", "Banking")

mandt <- readr::read_csv("Original_Datasets/YahooFinance/MTB.csv", col_names = TRUE, show_col_types = FALSE)
mtb_df <- prep_df_post_csv_read(mandt, "MTB", "Banking")

pnc <- readr::read_csv("Original_Datasets/YahooFinance/PNC.csv", col_names = TRUE, show_col_types = FALSE)
pnc_df <- prep_df_post_csv_read(pnc, "PNC", "Banking")

#Retail
target <- readr::read_csv("Original_Datasets/YahooFinance/TGT.csv", col_names = TRUE, show_col_types = FALSE)
tgt_df <- prep_df_post_csv_read(target, "TGT", "Retail")

wmt <- readr::read_csv("Original_Datasets/YahooFinance/WMT.csv", col_names = TRUE, show_col_types = FALSE)
wmt_df <- prep_df_post_csv_read(wmt, "WMT", "Retail")

costco <- readr::read_csv("Original_Datasets/YahooFinance/COST.csv", col_names = TRUE, show_col_types = FALSE)
cost_df <- prep_df_post_csv_read(costco, "COST", "Retail")

#Add to List
stock_df_list <- c(appl_df, jnj_df, jpm_df, mrna_df, mtb_df, nvda_df, tgt_df, wmt_df, cost_df, pnc_df, abbv_df, meta_df)
```

After that, we have a list of 8 dataframes that look like this.
```{r, show_apple}
head(target)
head(tgt_df)
```

##Creating Individual Lines for Learning
I am now going to create dataframes where each line represents an 8 month period of changes for every line that I can in these dateframes.

```{r, create_learning_df}
k_month_learning_df_from_adjusted <- function(df, k){
  
  learn_df_rows <- nrow(df) - k - 1
  
  colnames_adj_percent <- paste0("Adj_Pct_Change", 1:k)
  colnames_percent <- paste0("Pct_Change", 1:k)
  colnames_vol <- paste0("Volume", 1:k)
  
  adj_perc_df <- data.frame(matrix(NA, nrow = 0, ncol = k, dimnames = list(NULL, colnames_adj_percent)))
  perc_df <- data.frame(matrix(NA, nrow = 0, ncol = k, dimnames = list(NULL, colnames_percent)))
  vol_df <- data.frame(matrix(NA, nrow = 0, ncol = k, dimnames = list(NULL, colnames_vol)))
  
  const_columns <- data.frame(
    Ticker = df$Ticker[0],
    Industry = df$Industry[0],
    Actual_PerChange = numeric(),
    Actual_AdjPerChange = numeric()
  )
  
  
  learning_df <- cbind(const_columns, adj_perc_df, perc_df, vol_df)
  
  i <- 0
  while(i < learn_df_rows){
    new_data <- data.frame(matrix(NA, nrow = 1, ncol = ncol(learning_df)))
    colnames(new_data) = colnames(learning_df)
    
    new_data$Ticker <- df$Ticker[1]
    new_data$Industry <- df$Industry[1]
    new_data$Actual_PerChange <- df$Pct_Change[i+k+1]
    new_data$Actual_AdjPerChange <- df$Adj_Pct_Change[i+k+1]
    
    for(j in 1:k){
      volcol <- paste0("Volume",j)
      new_data[volcol] <- df$Volume[i+j]
      
      pct_change_col <- paste0("Pct_Change",j)
      new_data[pct_change_col] <- df$Pct_Change[i+j]
      
      adj_pct_change_col <- paste0("Adj_Pct_Change",j)
      new_data[adj_pct_change_col] <- df$Adj_Pct_Change[i+j]
    }
    learning_df <- rbind(learning_df, new_data)
    
    i <- i+1
  }
  
  return(learning_df)
}
```


```{r, appl_learning_df}
k_month_learning_df_from_adjusted(tgt_df, 8)
```

